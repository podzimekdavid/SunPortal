@attribute [Authorize]
@page "/"
@using SunPortal.Cloud.Lib.Interfaces
@using SunPortal.Cloud.Lib.App
@using System.Collections
@using Microsoft.AspNetCore.Identity

@inject IDevicesService Devices
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject UserManager<IdentityUser> UserManager

@foreach (var client in _clients)
{
    <div>
        @client.Name
    </div>
}

@code{

    private IEnumerable<Client> _clients = new List<Client>();

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            //if (Context.HttpContext?.User != null)
            var state = await AuthenticationStateProvider.GetAuthenticationStateAsync();
                _clients = await Devices.ClientsByOwner(UserManager.GetUserId(state.User));

            StateHasChanged();
        }
    }


}